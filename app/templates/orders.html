{% extends "base.html" %} {% block title %}My Orders - ShopNow{% endblock %} {%
block content %}
<h2 class="text-3xl font-semibold mb-8 border-b border-yellow-400 pb-2">
  My Orders
</h2>

{% if orders %}
<div class="space-y-8">
  {% for order in orders %}
  <section
    class="bg-white shadow-lg rounded-lg p-6"
    role="region"
    aria-label="Order {{ order.id }}"
  >
    {% set has_return = order.return_requests|length > 0 %}
    <header
      class="flex justify-between items-center border-b border-gray-300 pb-3 mb-6"
    >
      <h3 class="text-xl font-bold text-gray-900">Order #{{ order.id }}</h3>
      <div class="flex items-center space-x-2">
        <time
          class="text-gray-500 text-sm"
          datetime="{{ order.timestamp.isoformat() }}"
        >
          {{ order.timestamp.strftime('%b %d, %Y %I:%M %p') }}
        </time>
        {% if order.status == "Cancelled" %}
        <span
          class="ml-2 px-2 py-1 bg-red-100 text-red-600 text-xs font-semibold rounded"
          >Cancelled</span
        >
        {% endif %} {% if has_return %}
        <span
          class="ml-2 px-2 py-1 bg-yellow-100 text-yellow-700 text-xs font-semibold rounded"
        >
          Return/Refund Requested
        </span>
        {% endif %}
      </div>
    </header>

    <div class="space-y-6">
      {% for item in order.items %}
      <div class="flex items-center space-x-4">
        {% if item.product and item.product.image_url %}
        <img
          src="{{ item.product.image_url }}"
          alt="{{ item.product.name }}"
          loading="lazy"
          class="w-24 h-24 rounded-md object-cover shadow"
        />
        {% else %} {% if order.status == "Cancelled" %}
        <div
          class="w-24 h-24 flex items-center justify-center bg-red-100 rounded-md text-red-500 font-semibold select-none border border-red-300"
        >
          Order Cancelled
        </div>
        {% else %}
        <div
          class="w-24 h-24 flex items-center justify-center bg-gray-200 rounded-md text-gray-400 font-semibold select-none"
        >
          No Image
        </div>
        {% endif %} {% endif %}
        <div class="flex-1">
          <h4 class="text-lg font-semibold text-gray-800 mb-1">
            {{ item.product.name if item.product else 'Product Deleted' }}
          </h4>
          <p class="text-gray-600 mb-1">Qty: {{ item.quantity }}</p>
          <p class="text-gray-500 text-sm">
            Unit Price: {% if item.product %}
            <span class="font-medium"
              >₹{{ "%.2f"|format(item.product.price) }}</span
            >
            {% else %} N/A {% endif %}
          </p>
        </div>
      </div>
      {% endfor %}
    </div>

    <footer class="border-t border-gray-300 mt-6 pt-4 text-right">
      <span class="text-xl font-bold text-gray-900">
        Total: ₹{{ "%.2f"|format(order.total_amount) }}
      </span>
      {% if order.status == "Completed" %}
      <!-- <a
        href="{{ url_for('main_bp.return_request', order_id=order.id) }}"
        class="ml-4 inline-block bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-1 px-3 rounded text-sm"
      >
        Request Return
      </a> -->

      <a
        href="{{ url_for('main_bp.order_detail', order_id=order.id) }}"
        class="ml-4 inline-block bg-blue-500 hover:bg-blue-600 text-white font-bold py-1 px-3 rounded text-sm"
      >
        View Details
      </a>
      {% endif %}
    </footer>

    {% set return_requests = order.return_requests if order.return_requests else
    [] %} {% if return_requests %}
    <div class="mt-4">
      <h5 class="font-semibold text-yellow-700 mb-1">
        Return/Refund Requests:
      </h5>
      <ul class="text-sm text-gray-700">
        {% for req in return_requests %}
        <li>
          <span class="font-semibold">{{ req.status }}</span>
          (Requested on {{ req.created_at.strftime('%b %d, %Y') }}) {% if
          req.products %}
          <ul class="ml-4 list-disc">
            {% for prod in req.products %}
            <li>
              Product ID: {{ prod.product_id }}, Category: {{ prod.category }},
              Qty: {{ prod.quantity }}, Amount: ₹{{ "%.2f"|format(prod.amount)
              }}
            </li>
            {% endfor %}
          </ul>
          {% endif %}
        </li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}
  </section>
  {% endfor %}
</div>
{% else %}
<div
  class="mt-12 text-center text-gray-500 flex flex-col items-center space-y-3"
  role="alert"
>
  <svg
    xmlns="http://www.w3.org/2000/svg"
    class="h-12 w-12 text-yellow-400"
    fill="none"
    viewBox="0 0 24 24"
    stroke="currentColor"
    stroke-width="2"
    aria-hidden="true"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      d="M9.172 16.828a4 4 0 005.656 0M15 12a3 3 0 00-6 0 3 3 0 006 0zM12 2v2m0 16v2m8-8h-2M4 12H2m15.364-6.364l-1.414 1.414M7.05 16.95l-1.414 1.414M16.95 16.95l1.414 1.414M7.05 7.05l1.414 1.414"
    />
  </svg>
  <p class="text-lg font-medium">You haven't placed any orders yet.</p>
</div>
{% endif %} {% endblock %}
